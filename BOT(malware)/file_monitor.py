import os
import time
from watchdog.observers import Observer
from watchdog.events import FileSystemEventHandler
from discord_module import DiscordHandler  # Import the DiscordHandler module

class FileMonitor(FileSystemEventHandler):
    def __init__(self, discord_handler, monitored_folder):
        super(FileMonitor, self).__init__()
        self.discord_handler = discord_handler
        self.monitored_folder = monitored_folder

    def on_any_event(self, event):
        if event.is_directory:
            return
        event_type = event.event_type
        file_path = os.path.relpath(event.src_path, self.monitored_folder)
        if event_type == 'modified':
            message = f"File {file_path} has been modified."
        elif event_type == 'created':
            message = f"File {file_path} has been added."
            self.discord_handler.send_file(event.src_path, content=message)
        elif event_type == 'deleted':
            message = f"File {file_path} has been deleted."
        elif event_type == 'moved':
            message = f"File {file_path} has been moved to {os.path.relpath(event.dest_path, self.monitored_folder)}."
        else:
            message = f"Unknown event type for file {file_path}: {event_type}"
        self.discord_handler.send_text_message(message)

def start_file_monitoring(discord_webhook_url, monitored_folder):
    discord_handler = DiscordHandler(discord_webhook_url)
    event_handler = FileMonitor(discord_handler, monitored_folder)
    observer = Observer()
    observer.schedule(event_handler, path=monitored_folder, recursive=True)
    observer.start()

    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        observer.stop()
    observer.join()

if __name__ == "__main__":
    # Example usage of the file monitoring module
    discord_webhook_url = "https://discordapp.com/api/webhooks/1167795441220460574/uIb8VBmgbM41RcWNe2yFowlrkm_n5yIFavDkN9L5ka5KbWNBwey6_AxCSkSWxRXyfmGU"
    monitored_folder = os.path.expanduser("~/Desktop")  # Monitor the desktop folder
    start_file_monitoring(discord_webhook_url, monitored_folder)
